<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kelola Artikel | Admin Smart Traffic Vision</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Google Fonts - Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      background-color: #000000 !important;
      color: #e0e0e0;
      font-family: 'Poppins', sans-serif;
      padding-top: 70px;
    }

    /* Navbar disesuaikan agar lebih mirip Flutter */
    .navbar {
      background-color: #1a1a1a !important;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
    }
    .navbar-brand {
      font-weight: 700;
      color: #0dcaf0 !important;
    }
    .navbar-nav .nav-link {
      color: #e0e0e0 !important;
      font-weight: 500;
      margin-right: 15px;
      transition: color 0.2s ease;
    }
    .navbar-nav .nav-link:hover,
    .navbar-nav .nav-link.active {
      color: #0dcaf0 !important;
    }
    .btn-outline-light {
      color: #0dcaf0;
      border-color: #0dcaf0;
      font-weight: 600;
      transition: background-color 0.2s ease, color 0.2s ease;
    }
    .btn-outline-light:hover {
      background-color: #0dcaf0;
      color: #1a1a1a;
    }

    h2 {
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 40px;
    }

    /* Table styles */
    .table-responsive {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    .table {
      color: #e0e0e0;
      background-color: #1a1a1a;
      margin-bottom: 0;
    }

    .table thead th {
      color: #0dcaf0;
      background-color: #222222;
      border-bottom: 2px solid #333333;
      font-weight: 600;
    }

    .table tbody tr {
      border-color: #333333;
    }
    .table tbody tr:hover {
        background-color: #2a2a2a;
    }
    .table-striped > tbody > tr:nth-of-type(odd) {
      background-color: #1a1a1a;
    }
    .table-striped > tbody > tr:nth-of-type(even) {
      background-color: #202020;
    }

    .btn {
      border-radius: 8px;
      font-weight: 500;
    }
    .btn-success { background-color: #28a745; border-color: #28a745; }
    .btn-success:hover { background-color: #218838; border-color: #1e7e34; }
    .btn-warning { background-color: #ffc107; border-color: #ffc107; color: #1a1a1a; }
    .btn-warning:hover { background-color: #e0a800; border-color: #d39e00; }
    .btn-danger { background-color: #dc3545; border-color: #dc3545; }
    .btn-danger:hover { background-color: #c82333; border-color: #bd212f; }
    .btn-secondary { background-color: #6c757d; border-color: #6c757d; }
    .btn-secondary:hover { background-color: #5a6268; border-color: #545b62; }
    .btn-info { background-color: #0dcaf0; border-color: #0dcaf0; color: #1a1a1a; }
    .btn-info:hover { background-color: #0bbddf; border-color: #0bbddf; }

    .badge {
        font-size: 0.8rem;
        padding: 6px 10px;
        border-radius: 10px;
    }

    /* Pagination */
    .pagination .page-link {
      background-color: #333333;
      border-color: #555555;
      color: #e0e0e0;
      border-radius: 8px;
      margin: 0 3px;
      transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    }
    .pagination .page-item.active .page-link,
    .pagination .page-link:hover {
      background-color: #0dcaf0;
      border-color: #0dcaf0;
      color: #1a1a1a;
    }

    /* Flash messages */
    .alert {
        border-radius: 10px;
        color: #fff; /* Pastikan teks flash message terlihat di background gelap */
    }
    .alert-success { background-color: #28a745; }
    .alert-danger { background-color: #dc3545; }
    .alert-info { background-color: #17a2b8; } /* Warnanya sedikit berbeda dari link/badge info, tapi umum */
    .alert-warning { background-color: #ffc107; color: #1a1a1a; }


    /* Footer */
    footer {
      background-color: #1a1a1a;
      color: #888;
      font-size: 0.85rem;
      padding: 20px 0;
      border-top: 1px solid #333;
      margin-top: 50px; /* Jarak dari konten utama */
    }
  </style>
</head>

<body>
  <!-- ===== NAVBAR ===== -->
  <header class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
      <a class="navbar-brand" href="{{ url_for('index') }}">SMART TRAFFIC VISION</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="{{ url_for('admin_dashboard') }}">Dashboard Admin</a></li>
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="{{ url_for('kelola_artikel') }}">Kelola Artikel</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('cctv_page') }}">Peta CCTV</a></li>
        </ul>
        <a href="{{ url_for('logout') }}" class="btn btn-outline-light rounded-pill ms-lg-3">Logout</a>
      </div>
    </div>
  </header>

  <!-- ===== CONTENT ===== -->
  <div class="container mt-5 pt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">Kelola Artikel</h2>
      <a href="{{ url_for('tambah_artikel') }}" class="btn btn-info rounded-pill px-3"><i data-lucide="plus" class="me-1"></i> Tambah Artikel</a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if artikel %}
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead>
            <tr>
              <th>No</th>
              <th>Judul</th>
              <th>Gambar</th>
              <th>Status</th>
              <th>Tanggal</th>
              <th class="text-center">Aksi</th>
            </tr>
          </thead>
          <tbody>
            {% for a in artikel %}
            <tr>
              <td>{{ loop.index + (page - 1) * per_page }}</td>
              <td>{{ a.judul }}</td>
              <td>
                {% if a.gambar %}
                  <img src="{{ url_for('static', filename='uploads/' + a.gambar) }}" width="80" height="60" class="rounded object-fit-cover" alt="gambar">
                {% else %}
                  <span class="text-muted">Tidak ada</span>
                {% endif %}
              </td>
              <td>
                {% if a.published == 1 %}
                  <span class="badge bg-success">Published</span>
                {% else %}
                  <span class="badge bg-secondary">Draft</span>
                {% endif %}
              </td>
              <td>
                {% if a.tanggal %}
                  {{ a.tanggal.strftime('%Y-%m-%d %H:%M') }}
                {% else %}
                  N/A
                {% endif %}
              </td>
              <td class="text-center">
                <a href="{{ url_for('edit_artikel', id=a.id, next=request.url) }}" class="btn btn-warning btn-sm me-1">Edit</a>
                <a href="{{ url_for('hapus_artikel', id=a.id) }}" class="btn btn-danger btn-sm me-1" onclick="return confirm('Apakah Anda yakin ingin menghapus artikel ini?')">Hapus</a>

                {% if a.published == 0 %}
                  <a href="{{ url_for('publish_artikel', id=a.id) }}" class="btn btn-success btn-sm ms-1">Publish</a>
                {% else %}
                  <a href="{{ url_for('batal_publish', id=a.id) }}" class="btn btn-secondary btn-sm ms-1">Batal Publish</a>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- PAGINATION -->
      {% if total_pages > 1 %}
        <nav class="mt-4">
          <ul class="pagination justify-content-center">
            {% for p in range(1, total_pages + 1) %}
              <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('kelola_artikel', page=p) }}">{{ p }}</a>
              </li>
            {% endfor %}
          </ul>
        </nav>
      {% endif %}
    {% else %}
      <p class="text-center text-muted">Belum ada artikel.</p>
    {% endif %}
  </div>

  <!-- FOOTER -->
  <footer class="text-center py-4 mt-5">
    <div class="container">
      <small>Â© 2025 Smart Traffic Vision | Powered by Kelompok 3 5B Teknik Informatika</small>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    lucide.createIcons();

    // Kode JavaScript untuk menutup alert secara otomatis setelah 2 detik
    document.addEventListener('DOMContentLoaded', function() {
      var alerts = document.querySelectorAll('.alert');
      alerts.forEach(function(alert) {
        setTimeout(function() {
          var bsAlert = new bootstrap.Alert(alert);
          bsAlert.close();
        }, 2000); // 2000 milidetik = 2 detik
      });
    });
  </script>
</body>
</html>